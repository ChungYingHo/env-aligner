#!/usr/bin/env node
"use strict";var e=require("chalk"),n=require("commander"),i=require("fs"),s=require("path"),r=require("dotenv");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=o(e),a=o(n),l=o(i),c=o(s),d=o(r);function v(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p,m,u={};function g(){if(m)return p;m=1;const e=l.default,n=c.default,i=d.default,s=t.default,r=process.cwd(),o={schemaName:".env.example",envName:".env"},a={isCheckMissing:!0,isCheckEmptyValue:!0,isCheckExtra:!0},v=n=>{const r=e.readFileSync(n,"utf8"),o=i.parse(r);return o||(console.error(s.red.inverse(`\nFailed to parse ${n}`)),process.exit(1)),o},u=(e,i,r)=>{const o={...a,...r};var t;t=o,["isCheckMissing","isCheckEmptyValue","isCheckExtra"].forEach((e=>{e in t||(console.error(s.red.inverse(`\nMissing required key: ${e}`)),process.exit(1)),"boolean"!=typeof t[e]&&(console.error(s.red.inverse(`\n${e} must be a boolean`)),process.exit(1))}));const{isCheckMissing:l,isCheckEmptyValue:c,isCheckExtra:d}=o;l||c||d||(console.log(s.hex("#ff69b4").inverse("You have disabled all checks, nothing to do.")),process.exit(0));const p=v(e),m=v(i),u=Object.keys(p),g=Object.keys(m),h=l?u.filter((e=>!g.includes(e))):[],f=c?u.filter((e=>p[e]&&!m[e]&&!h.includes(e))):[],y=d?g.filter((e=>!u.includes(e))):[],x=n.dirname(i);h.length>0&&(console.error(s.red.inverse(`\nMissing variables in ${x}`)),console.log(s.red(`${h.join(", ")}`))),f.length>0&&(console.error(s.hex("#FFA500").inverse(`\nEmpty value variables in ${x}`)),console.log(s.hex("#FFA500")(`${f.join(", ")}`))),y.length>0&&(console.error(s.blue.inverse(`\nExtra variables in ${x}`)),console.log(s.blue(`${y.join(", ")}`))),h.length>0||f.length>0?process.exit(1):console.log(s.green.inverse(`\nAll variables in ${x} are correct!`))},g=async({rootDir:i=r,fileNames:t=o,checkOptions:l=a}={})=>{try{(await e.promises.stat(i)).isDirectory()||(console.error(s.inverse.red(`\nError: ${i} is not a directory.`)),process.exit(1))}catch(e){console.error(s.inverse.red(`\nError: ${i} does not exist or is not accessible.`)),process.exit(1)}const c={...o,...t};(e=>{["schemaName","envName"].forEach((n=>{n in e||(console.error(s.red.inverse(`\nMissing required key: ${n}`)),process.exit(1)),"string"!=typeof e[n]&&(console.error(s.red.inverse(`\n${n} must be a string`)),process.exit(1))}))})(c);const{schemaName:d,envName:v}=c,p=await e.promises.readdir(i,{withFileTypes:!0});let m=!0;await Promise.all(p.map((async r=>{const o=n.join(i,r.name);if(r.isDirectory()&&"node_modules"!==r.name&&"dist"!==r.name)await g({rootDir:o,fileNames:t,checkOptions:l});else if(r.isFile()&&m){m=!1;const r=n.join(i,d),o=n.join(i,v);let t=!1,a=!1;try{await e.promises.stat(r),t=!0}catch(e){t=!1}try{await e.promises.stat(o),a=!0}catch(e){a=!1}t&&a?u(r,o,l):t||a?t?a||console.warn(s.inverse.yellow(`\nCannot find ${v} in ${i}.`)):console.warn(s.inverse.yellow(`\nCannot find ${d} in ${i}.`)):console.warn(s.inverse.yellow(`\nCannot find ${d} and ${v} in ${i}.`))}})))};return p=g}var h,f={name:"env-aligner",version:"1.0.0",description:"A developer-friendly tool for validating and aligning environment variables in .env files against schema files (e.g., .env.example). It helps identify missing variables, empty values, or extra entries, ensuring a consistent and error-free environment setup.",keywords:[".env",".env.example","dotenv","environment variables","check","align"],homepage:"https://github.com/ChungYingHo/env-aligner",bugs:{url:"https://github.com/ChungYingHo/env-aligner/issues"},repository:{type:"git",url:"https://github.com/ChungYingHo/env-aligner.git"},contributors:["Jeremy Ho <ag.cyho@gmail.com>(https://codefictionist.com/)","MJC <5iftisland@gmail.com>(https://github.com/JuiCheng)"],license:"MIT",main:"dist/index.min.js",bin:{"env-aligner":"dist/cli.min.js"},scripts:{test:'echo "Error: no test specified" && exit 1',dev:"rollup -c -w",build:"rmdir /s /q dist && rollup -c"},dependencies:{chalk:"^4.1.2",commander:"^12.1.0",dotenv:"^16.4.5"},devDependencies:{"@eslint/js":"^9.15.0","@rollup/plugin-commonjs":"^28.0.1","@rollup/plugin-json":"^6.1.0",eslint:"^9.15.0",globals:"^15.12.0",rollup:"^2.79.2","rollup-plugin-terser":"^7.0.2"},files:["dist"],engines:{node:">=18.0.0"}};var y=function(){if(h)return u;h=1;const e=t.default,{program:n,Option:i}=a.default,s=g(),{version:r}=f,o=".env.example",l=".env",c=process.cwd();n.name("env-aligner").description("A tool to align the env variables in the project").version(r,"-v","--version").showSuggestionAfterError().addHelpText("beforeAll",(()=>{console.log(e.green("Env Aligner is working!"))})).addOption(new i("-s, --schema <schema>","The schema file for environment variables, default is .env.example.").default(".env.example")).addOption(new i("-e, --env <env>","The env file to check, default is .env.").default(".env")).addOption(new i("-m, --missing <missing>","Check missing variables in the env file.").default(!0)).addOption(new i("-n, --empty <empty>","Check empty value variables in the env file.").default(!0)).addOption(new i("-x, --extra <extra>","Check extra variables in the env file.").default(!0)).addHelpText("after","\n    Examples:\n        $ env-aligner\n        $ env-aligner -s .env.example -e .env\n        $ env-aligner -s .env.example\n        $ env-aligner -e .env\n    ").parse(process.argv);const{INIT_CWD:d}=process.env,v=d||c,{schema:p=o,env:m=l,missing:y=!0,empty:x=!0,extra:b=!0}=n.opts();return s({rootDir:v,fileNames:{schemaName:p,envName:m},checkOptions:{isCheckMissing:JSON.parse(y),isCheckEmptyValue:JSON.parse(x),isCheckExtra:JSON.parse(b)}}),u}(),x=v(y);module.exports=x;
//# sourceMappingURL=cli.min.js.map
